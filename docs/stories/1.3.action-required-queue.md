# Story 1.3: Action Required Queue

## Status

**Ready for Review**

## Story

**As a** Sunday School teacher,
**I want** a unified "Action Required" page showing all pending approvals and reviews in one place,
**So that** I can efficiently process trip approvals, competition reviews, and other pending actions without navigating to multiple sections.

## Acceptance Criteria

1. Teacher sees a unified queue of all pending actions
2. Actions are grouped by type (Trips, Competitions, Activities)
3. Each pending item shows: student info, request type, timestamp, context
4. Filter chips allow filtering by action type (All, Trips, Competitions)
5. Trip approval cards have Approve/Reject buttons with confirmation
6. Competition review cards link to review submission page
7. Rejection requires optional reason selection
8. Success/error feedback shown after each action
9. Empty state shown when no pending actions
10. All components support dark mode
11. All components are accessible (keyboard navigation, screen reader support)
12. Layout is responsive (mobile-first, adapts to tablet/desktop)
13. Components support RTL layout for Arabic language

## Tasks / Subtasks

- [x] Task 1: Create ApprovalCard component (AC: 3, 5, 7, 8, 10, 11, 12, 13)
  - [x] Create `src/components/teacher/ApprovalCard.tsx` with TypeScript interface
  - [x] Display student avatar, name, request type, timestamp
  - [x] Add Approve/Reject action buttons
  - [x] Add loading state during action processing
  - [x] Add success/error feedback animation
  - [x] Ensure 44px minimum touch targets
  - [x] Add dark mode support
  - [x] Add RTL support

- [x] Task 2: Create RejectionReasonModal component (AC: 7, 10, 11, 12, 13)
  - [x] Create `src/components/teacher/RejectionReasonModal.tsx`
  - [x] Display predefined rejection reasons as selectable options
  - [x] Allow custom reason input
  - [x] Add confirm/cancel buttons
  - [x] Add keyboard navigation support

- [x] Task 3: Create ActionRequiredPage (AC: 1, 2, 4, 9, 10, 11, 12, 13)
  - [x] Create `src/app/dashboard/teacher/action-required/page.tsx`
  - [x] Fetch all pending actions with server action
  - [x] Group actions by type with section headers
  - [x] Add filter chips (All, Trips, Competitions)
  - [x] Add empty state with helpful message
  - [x] Add loading skeleton
  - [x] Integrate with TeacherBottomNav

- [x] Task 4: Create server actions for approvals (AC: 5, 6, 7, 8)
  - [x] Create `src/app/dashboard/teacher/action-required/actions.ts`
  - [x] Implement `getPendingActions()` - fetch all pending items
  - [x] Implement `approveTripRequest()` - approve trip participant
  - [x] Implement `rejectTripRequest()` - reject with optional reason
  - [x] Add proper error handling
  - [x] Add Supabase RLS filtering

- [x] Task 5: Add i18n translations (AC: 13)
  - [x] Add English translations under `teacher.actionRequired` namespace
  - [x] Add Arabic translations under `teacher.actionRequired` namespace

- [ ] Task 6: Write component tests (BLOCKED - No test framework configured)
  - [ ] Test ApprovalCard renders correctly
  - [ ] Test approve/reject actions work
  - [ ] Test filter chips filter correctly

## Dev Notes

### Existing Patterns to Follow

**Component Structure:**
```typescript
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
```

**Existing Components to Reuse:**
- `Card`, `CardContent` from `@/components/ui/card`
- `Badge` from `@/components/ui/badge`
- `Button` from `@/components/ui/button`
- `Dialog` from `@/components/ui/dialog`
- `OptimizedAvatar` from `@/components/ui/optimized-avatar`
- `EmptyState` from `@/components/ui/empty-state`
- `TeacherBottomNav` from `@/components/teacher`

### Data Types

```typescript
interface ApprovalCardProps {
  id: string
  type: 'trip' | 'competition' | 'activity'
  student: {
    id: string
    name: string
    avatarUrl?: string
  }
  title: string
  subtitle?: string
  requestedAt: Date
  parentInitiated?: boolean
  onApprove: () => Promise<void>
  onReject: (reason?: string) => Promise<void>
  onStudentClick?: () => void
}

interface PendingAction {
  id: string
  type: 'trip' | 'competition' | 'activity'
  studentId: string
  studentName: string
  studentAvatar?: string
  title: string
  subtitle?: string
  requestedAt: string
  parentInitiated: boolean
  tripId?: string
  competitionId?: string
}
```

### Reference Document

Full UI/UX specification: `docs/teacher-dashboard-front-end-spec.md` (Section 4.2 - Screen 3)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-10 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

1. **date-fns dependency issue** - Removed date-fns import and implemented custom relative time formatting to avoid adding new dependencies.
2. **TypeScript async callback issue** - Fixed onReject callback to return Promise<void> as required by the type.

### Completion Notes List

1. **Tasks 1-5 Completed Successfully**
   - ApprovalCard with loading states, success feedback, and approve/reject buttons
   - RejectionReasonModal with predefined reasons and custom input
   - ActionRequiredPage with filter chips and grouped actions
   - Server actions for trip approvals with RLS verification
   - Full i18n translations for English and Arabic

2. **Task 6 (Tests) - Blocked**
   - No testing framework (Vitest/Jest) is configured in this project

3. **TypeScript Verification**
   - All components pass TypeScript strict mode check
   - No type errors in action-required files

4. **Note on Competition Reviews**
   - Competition submission reviews are stubbed as placeholders
   - Full implementation would require competition submission tables

### File List

**Created:**
- `src/components/teacher/ApprovalCard.tsx`
- `src/components/teacher/RejectionReasonModal.tsx`
- `src/app/dashboard/teacher/action-required/page.tsx`
- `src/app/dashboard/teacher/action-required/actions.ts`
- `src/app/dashboard/teacher/action-required/loading.tsx`
- `src/app/dashboard/teacher/action-required/ActionRequiredContent.tsx`

**Modified:**
- `src/components/teacher/index.ts` (added ApprovalCard and RejectionReasonModal exports)
- `messages/en.json` (extended teacher.actionRequired namespace)
- `messages/ar.json` (extended teacher.actionRequired namespace)

---

## QA Results

*To be filled by QA Agent*
