# Story 1.4: Student Drawer

## Status

**Ready for Review**

## Story

**As a** Sunday School teacher,
**I want** a slide-up drawer that shows student details when I tap on any student name or avatar,
**So that** I can quickly view student information without losing my current context or navigating away from my current page.

## Acceptance Criteria

1. Tapping any student name/avatar opens a bottom sheet drawer
2. Drawer shows student photo, name, class, and parent contact
3. Quick stats row displays: points balance, attendance %, activities count
4. Tabs allow switching between Profile, Points, Activities, Attendance views
5. Profile tab shows parent info, notes, and basic details
6. Points tab shows points history and balance breakdown
7. Attendance tab shows recent attendance records
8. Close button or swipe down dismisses drawer
9. Drawer preserves parent page state when closed
10. All components support dark mode
11. All components are accessible (keyboard navigation, screen reader support)
12. Layout is responsive (bottom sheet mobile, side drawer desktop)
13. Components support RTL layout for Arabic language

## Tasks / Subtasks

- [x] Task 1: Create StudentDrawer component (AC: 1, 2, 3, 8, 9, 10, 11, 12, 13)
  - [x] Create `src/components/teacher/StudentDrawer.tsx` with TypeScript interface
  - [x] Use Sheet component as base (bottom sheet mobile, side drawer desktop)
  - [x] Display student header with avatar, name, class
  - [x] Add quick stats row (points, attendance, activities)
  - [x] Add close button and swipe-to-dismiss
  - [x] Add dark mode support
  - [x] Add RTL support

- [x] Task 2: Create StudentProfileTab component (AC: 5, 10, 11, 13)
  - [x] Create `src/components/teacher/StudentProfileTab.tsx`
  - [x] Display parent/guardian contact info
  - [x] Show student notes (allergies, special needs)
  - [x] Display user code and basic info

- [x] Task 3: Create StudentPointsTab component (AC: 6, 10, 11, 13)
  - [x] Create `src/components/teacher/StudentPointsTab.tsx`
  - [x] Display points balance breakdown (available, suspended, total)
  - [x] Show recent points transactions list
  - [x] Add "Adjust Points" button for teachers

- [x] Task 4: Create StudentAttendanceTab component (AC: 7, 10, 11, 13)
  - [x] Create `src/components/teacher/StudentAttendanceTab.tsx`
  - [x] Display attendance rate summary
  - [x] Show recent attendance records with status
  - [x] Add visual calendar or list view

- [x] Task 5: Create server actions for student data (AC: 2, 3, 5, 6, 7)
  - [x] Create API routes under `/api/teacher/students/[studentId]/`
  - [x] Implement student details endpoint - fetch full student info
  - [x] Implement points endpoint - fetch points history
  - [x] Implement attendance endpoint - fetch attendance records
  - [x] Add proper error handling and RLS filtering

- [x] Task 6: Create useStudentDrawer hook (AC: 1, 9)
  - [x] Create `src/hooks/useStudentDrawer.tsx`
  - [x] Manage drawer open/close state
  - [x] Handle student data fetching
  - [x] Provide context for drawer usage across app

- [x] Task 7: Integrate drawer into existing pages (AC: 1)
  - [x] Add student click handlers to ClassRosterPage via ClassRosterClient
  - [x] Add student click handlers to ApprovalCard in ActionRequiredContent
  - [x] Render StudentDrawer in integrated pages

- [x] Task 8: Add i18n translations (AC: 13)
  - [x] Add English translations under `teacher.studentDrawer` namespace
  - [x] Add Arabic translations under `teacher.studentDrawer` namespace

- [ ] Task 9: Write component tests (BLOCKED - No test framework configured)
  - [ ] Test StudentDrawer opens/closes correctly
  - [ ] Test tab switching works
  - [ ] Test data displays correctly

## Dev Notes

### Existing Patterns to Follow

**Component Structure:**
```typescript
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
```

**Existing Components to Reuse:**
- `Sheet`, `SheetContent`, `SheetHeader` from `@/components/ui/sheet`
- `Tabs`, `TabsList`, `TabsTrigger`, `TabsContent` from `@/components/ui/tabs`
- `OptimizedAvatar` from `@/components/ui/optimized-avatar`
- `Badge` from `@/components/ui/badge`
- `Card` from `@/components/ui/card`

### Data Types

```typescript
interface StudentDrawerProps {
  studentId: string
  open: boolean
  onOpenChange: (open: boolean) => void
  initialTab?: 'profile' | 'points' | 'activities' | 'attendance'
}

interface StudentDetails {
  id: string
  fullName: string
  avatarUrl?: string
  userCode?: string
  className: string
  churchName: string
  parentName?: string
  parentPhone?: string
  parentEmail?: string
  notes?: string
  pointsBalance: number
  attendanceRate: number
  activitiesCount: number
}
```

### Reference Document

Full UI/UX specification: `docs/teacher-dashboard-front-end-spec.md` (Section 4.2 - Screen 4)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-10 | 1.0 | Initial story creation | James (Dev) |
| 2026-01-10 | 1.1 | Implementation complete - Ready for Review | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

- Fixed JSX in .ts file: Renamed `useStudentDrawer.ts` to `useStudentDrawer.tsx` for JSX support

### Completion Notes List

- Created StudentDrawer component using Sheet with bottom slide animation (mobile) / side drawer (desktop)
- Created StudentProfileTab showing parent contact, class info, and notes
- Created StudentPointsTab with balance breakdown and transaction list
- Created StudentAttendanceTab with rate summary and recent records
- Implemented API routes instead of server actions (better for client-side data fetching in tabs)
- Created useStudentDrawer hook with context provider for state management
- Integrated drawer into ClassRosterClient (new client component for roster page)
- Integrated drawer into ActionRequiredContent (ApprovalCard onStudentClick)
- Added full i18n support (English + Arabic) under `teacher.studentDrawer` namespace
- Task 9 (Tests) remains BLOCKED - no test framework configured

### File List

**New Files:**
- `src/components/teacher/StudentDrawer.tsx` - Main drawer component with header, stats, and tabs
- `src/components/teacher/StudentProfileTab.tsx` - Profile tab with parent and class info
- `src/components/teacher/StudentPointsTab.tsx` - Points tab with balance and transactions
- `src/components/teacher/StudentAttendanceTab.tsx` - Attendance tab with rate and records
- `src/app/api/teacher/students/[studentId]/route.ts` - Student details API
- `src/app/api/teacher/students/[studentId]/points/route.ts` - Points data API
- `src/app/api/teacher/students/[studentId]/attendance/route.ts` - Attendance data API
- `src/hooks/useStudentDrawer.tsx` - Hook and context for drawer state management
- `src/app/dashboard/teacher/classes/[classId]/roster/ClassRosterClient.tsx` - Client wrapper for roster

**Modified Files:**
- `src/components/teacher/index.ts` - Added exports for new components
- `src/app/dashboard/teacher/classes/[classId]/roster/page.tsx` - Integrated ClassRosterClient
- `src/app/dashboard/teacher/action-required/ActionRequiredContent.tsx` - Added drawer integration
- `messages/en.json` - Added `teacher.studentDrawer` translations
- `messages/ar.json` - Added `teacher.studentDrawer` Arabic translations

---

## QA Results

*To be filled by QA Agent*
