# Story 1.6: My Announcements

## Status

**Ready for Review**

## Story

**As a** Sunday School teacher,
**I want** a dedicated announcements page to view and manage announcements relevant to me,
**So that** I can stay informed about important updates and communicate with my students and their parents.

## Acceptance Criteria

1. Bottom nav shows "My Announcements" with unread count badge
2. Announcements page shows list of relevant announcements
3. Announcements are filtered by user's church and targeted audience
4. Each announcement shows title, date, sender, and preview
5. Unread announcements are visually distinguished
6. Clicking an announcement opens full details view
7. "Mark as read" functionality works automatically on view
8. Support for different announcement types (general, class-specific, urgent)
9. Urgent announcements are highlighted prominently
10. All components support dark mode
11. All components are accessible (keyboard navigation, screen reader support)
12. Layout is responsive (optimized for mobile-first)
13. Components support RTL layout for Arabic language

## Tasks / Subtasks

- [x] Task 1: Create AnnouncementCard component (AC: 4, 5, 9, 10, 11, 13)
  - [x] Create `src/components/teacher/AnnouncementCard.tsx`
  - [x] Display title, date, sender avatar, and preview
  - [x] Visual distinction for unread (dot indicator, bold text)
  - [x] Urgent announcement styling (border, icon)
  - [x] Add skeleton loading state

- [x] Task 2: Create AnnouncementDetail component (AC: 6, 7, 10, 11, 13)
  - [x] Create `src/components/teacher/AnnouncementDetail.tsx`
  - [x] Full announcement content display
  - [x] Markdown/rich text rendering
  - [x] Auto-mark as read on view
  - [x] Back navigation

- [x] Task 3: Create MyAnnouncementsPage (AC: 2, 3, 8, 12)
  - [x] Create `src/app/dashboard/teacher/announcements/page.tsx`
  - [x] List announcements with filtering
  - [x] Filter chips (All, Unread, Urgent)
  - [x] Empty state when no announcements
  - [x] Loading state

- [x] Task 4: Create server actions for announcements (AC: 2, 3, 7)
  - [x] Create `src/app/dashboard/teacher/announcements/actions.ts`
  - [x] Implement `getTeacherAnnouncements()` - fetch relevant announcements
  - [x] Implement `markAnnouncementRead()` - mark as read
  - [x] Implement `getUnreadCount()` - get unread count for badge

- [x] Task 5: Update TeacherBottomNav (AC: 1)
  - [x] Ensure unread count badge displays correctly
  - [x] Verify navigation to announcements page

- [x] Task 6: Add i18n translations (AC: 13)
  - [x] Add English translations under `teacher.announcements` namespace
  - [x] Add Arabic translations under `teacher.announcements` namespace

- [ ] Task 7: Write component tests (BLOCKED - No test framework configured)
  - [ ] Test announcement list renders correctly
  - [ ] Test mark as read functionality
  - [ ] Test filter chips work

## Dev Notes

### Existing Patterns to Follow

**Component Structure:**
```typescript
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
```

**Existing Components to Reuse:**
- `Card` from `@/components/ui/card`
- `Badge` from `@/components/ui/badge`
- `Button` from `@/components/ui/button`
- `OptimizedAvatar` from `@/components/ui/optimized-avatar`
- `EmptyState` from `@/components/ui/empty-state`
- `TeacherBottomNav` from `@/components/teacher`

### Data Types

```typescript
interface Announcement {
  id: string;
  title: string;
  title_ar?: string;
  content: string;
  content_ar?: string;
  type: 'general' | 'class' | 'urgent';
  sender: {
    id: string;
    name: string;
    avatar_url?: string;
  };
  target_audience: 'all' | 'teachers' | 'students' | 'parents';
  church_id: string;
  class_ids?: string[];
  is_read: boolean;
  published_at: string;
  expires_at?: string;
}
```

### Announcement Types

| Type | Icon | Color | Description |
|------|------|-------|-------------|
| General | Megaphone | Blue | Regular announcements |
| Class | BookOpen | Green | Class-specific updates |
| Urgent | AlertTriangle | Red | Urgent/important notices |

### Reference Document

Full UI/UX specification: `docs/teacher-dashboard-front-end-spec.md` (Section 2.2 - Navigation)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-10 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

None - Implementation proceeded without significant issues.

### Completion Notes List

1. Created AnnouncementCard component with unread indicator, type badges, and skeleton state
2. Created AnnouncementDetail component with markdown rendering and back navigation
3. Created AnnouncementsClient with filter chips (All/Unread/Urgent) and list/detail view switching
4. Created server actions for fetching announcements and marking as read
5. Updated TeacherBottomNav to route to new announcements page
6. Added English and Arabic i18n translations for announcements namespace
7. Task 7 (tests) blocked - no test framework configured

### File List

**Created:**
- `src/components/teacher/AnnouncementCard.tsx` - Announcement card with type styling and unread state
- `src/components/teacher/AnnouncementDetail.tsx` - Full announcement view component
- `src/app/dashboard/teacher/announcements/page.tsx` - Server component page
- `src/app/dashboard/teacher/announcements/AnnouncementsClient.tsx` - Client component with filtering
- `src/app/dashboard/teacher/announcements/actions.ts` - Server actions for announcements
- `src/app/dashboard/teacher/announcements/loading.tsx` - Loading state

**Modified:**
- `src/components/teacher/TeacherBottomNav.tsx` - Updated announcements href
- `src/components/teacher/index.ts` - Added exports for new components
- `messages/en.json` - Added teacher.announcements namespace
- `messages/ar.json` - Added teacher.announcements namespace (Arabic)

---

## QA Results

*To be filled by QA Agent*
