# Story 1.7: My Trips

## Status

**Ready for Review**

## Story

**As a** Sunday School teacher who organizes trips,
**I want** a dedicated "My Trips" page to view and manage trips I'm organizing,
**So that** I can easily track trip registrations, participants, and take attendance for trips.

## Acceptance Criteria

1. Bottom nav shows "My Trips" tab only when teacher is organizing at least one trip
2. My Trips page shows list of trips I'm organizing with key info
3. Each trip card shows name, date, participant count, and registration status
4. Clicking a trip card navigates to trip details with tabs (Participants, Organizers, Attendance)
5. Participants tab shows registered participants with approval status
6. Clicking a participant opens the Student Drawer
7. Trip attendance can be taken on the day of the trip
8. All components support dark mode
9. All components are accessible (keyboard navigation, screen reader support)
10. Layout is responsive (optimized for mobile-first)
11. Components support RTL layout for Arabic language

## Tasks / Subtasks

- [x] Task 1: Create TripCard component (AC: 3, 8, 9, 11)
  - [x] Create `src/components/teacher/TripCard.tsx`
  - [x] Display trip name, date, venue, participant count
  - [x] Show registration status (open/closed)
  - [x] Status indicator (upcoming, today, past)
  - [x] Add skeleton loading state

- [x] Task 2: Create MyTripsPage (AC: 2, 10)
  - [x] Create `src/app/dashboard/teacher/trips/page.tsx`
  - [x] List trips organized by teacher
  - [x] Empty state when not organizing any trips
  - [x] Loading state

- [x] Task 3: Create TripDetailsPage (AC: 4, 5, 6)
  - [x] Create `src/app/dashboard/teacher/trips/[tripId]/page.tsx`
  - [x] Create tabbed interface (Participants, Organizers, Attendance)
  - [x] Participants tab with list and Student Drawer integration
  - [x] Organizers tab showing co-organizers

- [x] Task 4: Create TripAttendance component (AC: 7)
  - [x] Reuse AttendanceStatusButton and AttendanceStudentRow
  - [x] Only enable on trip date
  - [x] Show appropriate message before/after trip

- [x] Task 5: Create server actions for trips (AC: 2, 4, 5)
  - [x] Create `src/app/dashboard/teacher/trips/actions.ts`
  - [x] Implement `getTeacherTrips()` - fetch trips I'm organizing
  - [x] Implement `getTripDetails()` - get trip with participants
  - [x] Implement `getTripParticipants()` - get participants list
  - [x] Implement `saveTripAttendance()` - save trip attendance

- [x] Task 6: Add i18n translations (AC: 11)
  - [x] Add English translations under `teacher.myTrips` namespace
  - [x] Add Arabic translations under `teacher.myTrips` namespace

- [ ] Task 7: Write component tests (BLOCKED - No test framework configured)
  - [ ] Test trip list renders correctly
  - [ ] Test trip details tabs work
  - [ ] Test attendance functionality

## Dev Notes

### Existing Patterns to Follow

**Component Structure:**
```typescript
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
```

**Existing Components to Reuse:**
- `Card` from `@/components/ui/card`
- `Badge` from `@/components/ui/badge`
- `Button` from `@/components/ui/button`
- `Tabs` from `@/components/ui/tabs`
- `EmptyState` from `@/components/ui/empty-state`
- `TeacherBottomNav` from `@/components/teacher`
- `AttendanceStatusButton` from `@/components/teacher`
- `AttendanceStudentRow` from `@/components/teacher`
- `useStudentDrawer` hook

### Data Types

```typescript
// From src/lib/types/modules/trips.ts
interface Trip {
  id: string;
  title: string;
  description?: string;
  destination: string;
  departure_date: string;
  return_date?: string;
  meeting_point?: string;
  meeting_time?: string;
  max_participants?: number;
  registration_start?: string;
  registration_end?: string;
  status: 'draft' | 'open' | 'closed' | 'completed' | 'cancelled';
}
```

### Trip Status Colors

| Status | Color | Description |
|--------|-------|-------------|
| upcoming | Blue | Future trip with open registration |
| today | Green | Trip is happening today |
| closed | Gray | Registration closed |
| past | Muted | Trip has ended |
| cancelled | Red | Trip was cancelled |

### Reference Document

Full UI/UX specification: `docs/teacher-dashboard-front-end-spec.md` (Section 2.1 - Site Map)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-10 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

Fixed TypeScript errors:
- Replaced date-fns with native Date methods for date formatting
- Fixed useStudentDrawer usage (render StudentDrawer manually)
- Fixed OptimizedAvatar size prop (use string "md" not number 40)
- Fixed array type assertions in server actions

### Completion Notes List

1. Created TripCard component with status badges and skeleton state
2. Created MyTripsPage with trip grouping (upcoming/past)
3. Created TripDetailsPage with tabbed interface (Participants, Organizers, Attendance)
4. Created TripAttendanceTab with reusable AttendanceStudentRow components
5. Created comprehensive server actions for trips
6. Added English and Arabic i18n translations for myTrips namespace
7. Task 7 (tests) blocked - no test framework configured

### File List

**Created:**
- `src/components/teacher/TripCard.tsx` - Trip card with status and participant info
- `src/app/dashboard/teacher/trips/page.tsx` - My Trips list page
- `src/app/dashboard/teacher/trips/MyTripsClient.tsx` - Client component for trip list
- `src/app/dashboard/teacher/trips/loading.tsx` - Loading skeleton
- `src/app/dashboard/teacher/trips/actions.ts` - Server actions for trips
- `src/app/dashboard/teacher/trips/[tripId]/page.tsx` - Trip details page
- `src/app/dashboard/teacher/trips/[tripId]/TripDetailsClient.tsx` - Trip details client
- `src/app/dashboard/teacher/trips/[tripId]/TripAttendanceTab.tsx` - Trip attendance tab

**Modified:**
- `src/components/teacher/index.ts` - Added TripCard exports
- `messages/en.json` - Added teacher.myTrips namespace
- `messages/ar.json` - Added teacher.myTrips namespace (Arabic)

---

## QA Results

*To be filled by QA Agent*
