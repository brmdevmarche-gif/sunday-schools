# Story 1.8: Global Search

## Status

**Ready for Review**

## Story

**As a** Sunday School teacher,
**I want** a global search feature accessible from any page header,
**So that** I can quickly find students, classes, or trips without navigating through multiple pages.

## Acceptance Criteria

1. Search icon is visible in the header on all teacher dashboard pages
2. Clicking the search icon opens a search modal/command palette
3. Search supports multiple entity types: students, classes, trips
4. Results are grouped by entity type with clear visual distinction
5. Typing shows instant results (debounced search)
6. Clicking a student result opens the Student Drawer
7. Clicking a class result navigates to class details
8. Clicking a trip result navigates to trip details
9. Empty state shown when no results match
10. Recent searches are remembered for quick access
11. Keyboard navigation works (arrow keys, Enter, Escape)
12. All components support dark mode
13. All components are accessible (keyboard navigation, screen reader support)
14. Components support RTL layout for Arabic language

## Tasks / Subtasks

- [x] Task 1: Create SearchCommand component (AC: 2, 4, 5, 9, 11, 12, 13, 14)
  - [x] Create `src/components/teacher/SearchCommand.tsx`
  - [x] Use Command component pattern (cmdk-style)
  - [x] Grouped results by type (Students, Classes, Trips)
  - [x] Loading state during search
  - [x] Empty state when no results

- [x] Task 2: Create SearchTrigger component (AC: 1)
  - [x] Create search button for header
  - [x] Show keyboard shortcut hint (⌘K / Ctrl+K)
  - [x] Integrate with existing header

- [x] Task 3: Create search server actions (AC: 3, 5)
  - [x] Create `src/app/dashboard/teacher/search/actions.ts`
  - [x] Implement `searchAll()` - unified search across entities
  - [x] Implement `searchStudents()` - search students in teacher's classes
  - [x] Implement `searchClasses()` - search teacher's classes
  - [x] Implement `searchTrips()` - search teacher's trips

- [x] Task 4: Add result navigation (AC: 6, 7, 8)
  - [x] Student result → Open Student Drawer
  - [x] Class result → Navigate to class page
  - [x] Trip result → Navigate to trip page

- [x] Task 5: Add recent searches (AC: 10)
  - [x] Store recent searches in localStorage
  - [x] Show recent searches when search is opened
  - [x] Clear recent searches option

- [x] Task 6: Add keyboard shortcuts (AC: 11)
  - [x] Cmd+K / Ctrl+K to open search
  - [x] Arrow keys to navigate results (via cmdk)
  - [x] Enter to select, Escape to close

- [x] Task 7: Integrate with teacher pages (AC: 1)
  - [x] Create TeacherHeader component with SearchTrigger
  - [x] Ensure consistent placement across all pages

- [x] Task 8: Add i18n translations (AC: 14)
  - [x] Add English translations under `teacher.search` namespace
  - [x] Add Arabic translations under `teacher.search` namespace

- [ ] Task 9: Write component tests (BLOCKED - No test framework configured)
  - [ ] Test search functionality
  - [ ] Test keyboard navigation
  - [ ] Test result navigation

## Dev Notes

### Existing Patterns to Follow

**Component Structure:**
```typescript
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
```

**Existing Components to Reuse:**
- `Command` from `@/components/ui/command` (if exists, or create based on cmdk)
- `Dialog` from `@/components/ui/dialog`
- `Input` from `@/components/ui/input`
- `OptimizedAvatar` from `@/components/ui/optimized-avatar`
- `useStudentDrawer` hook for opening student drawer

### Search Result Types

```typescript
interface SearchResult {
  id: string;
  type: 'student' | 'class' | 'trip';
  title: string;
  subtitle?: string;
  avatarUrl?: string;
  metadata?: Record<string, string>;
}

interface SearchResults {
  students: StudentSearchResult[];
  classes: ClassSearchResult[];
  trips: TripSearchResult[];
  totalCount: number;
}
```

### Keyboard Shortcuts

| Key | Action |
|-----|--------|
| ⌘K / Ctrl+K | Open search |
| ↑/↓ | Navigate results |
| Enter | Select result |
| Escape | Close search |
| Tab | Move between groups |

### Reference Document

Full UI/UX specification: `docs/teacher-dashboard-front-end-spec.md` (Section 2.2 - Header Elements)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-10 | 1.0 | Initial story creation | James (Dev) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

None - Implementation proceeded without significant issues.

### Completion Notes List

1. Created SearchCommand component using existing cmdk-based Command component
2. Created SearchTrigger button component for header integration
3. Created TeacherHeader component for consistent header with search across pages
4. Implemented server actions for unified search across students, classes, and trips
5. Added recent searches with localStorage persistence
6. Added Cmd+K / Ctrl+K keyboard shortcut via useSearchShortcut hook
7. Result navigation opens Student Drawer or navigates to class/trip pages
8. Added English and Arabic i18n translations
9. Task 9 (tests) blocked - no test framework configured

### File List

**Created:**
- `src/components/teacher/SearchCommand.tsx` - Search command dialog with results
- `src/components/teacher/TeacherHeader.tsx` - Consistent header with search
- `src/app/dashboard/teacher/search/actions.ts` - Server actions for search

**Modified:**
- `src/components/teacher/index.ts` - Added SearchCommand, SearchTrigger, TeacherHeader exports
- `messages/en.json` - Added teacher.search namespace
- `messages/ar.json` - Added teacher.search namespace (Arabic)

---

## QA Results

*To be filled by QA Agent*
